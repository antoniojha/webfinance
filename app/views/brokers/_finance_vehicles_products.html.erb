<div class="panel panel-default">
  <div class="panel-body" align="left">
    <h4>Financial Vehicle(s)
      <%=link_to broker_products_path(@broker), id:"vehicles_edit" do%>
      <span class="glyphicon glyphicon-edit"></span>
      <%end%>
    </h4>
    <%@broker.product_ids.each_with_index do |p,index|%>
      <%product=Product.find(p)%>
      <%if index==0%>
      <%=product.name%>
      <%else%>
      <%=", #{product.name}"%>
      <%end%>
    <%end%>
    <h4>Financial Product(s)</h4>

    <%@broker.product_ids.each_with_index do |product_id,index|%>
      <%product=Product.find(product_id)%>
      <%if product%>
      <div class="panel panel-default">
        <div class="panel-heading clearfix">
          <h3 class="panel-title">
            <%=render partial:"brokers/financial_product_add", locals:{product:product,index:index}%>   
          </h3>
        </div>        
        <%if @broker.financial_products.where(product_id:product.id).count>0%>  
        <div class="panel-body">
          <table width="100%" style="border-collapse: collapse;">
            <tr>
              <th>Company</th>
              <th>Product Name</th>
            </tr>
            <%@broker.financial_products.where(product_id:product.id).includes(:company).order("companies.name DESC").each do |financial_product|%> 
            <tr style="border:1px ridge;">
              <td width="45%"><%=financial_product.company.name%></td>
              <td width="50%"><%=financial_product.name%></td>
              <td width="5%"><%=link_to '<i class="glyphicon glyphicon-remove"></i>'.html_safe, {controller:"financial_products",action:"destroy",id:financial_product.id,broker_id:@broker.id},method: :delete,:remote => true, id:"remove_product_#{financial_product.id}" %>
              </td>
            </tr>          
            <%end%>
          </table>
        </div>
        <%end%>      
      </div>
      <%end%>
    <%end%>
  </div>
</div>