<%@comment=MicroComment.new%>


<div class="panel panel-default">
  <div class="panel-body">
    
    <table width="100%">
      <tr>
        <td width="15%">        
          <%=link_to @story.broker do %>
          <%=full_name(@story.broker)%><br>
          <%=smart_image(@story.broker,4)%>
          <%end%>
        </td>
        <td width="5%">
          <table width="100%">
            <tr>
              <td align="center">
                <%=link_to financial_story_path(id:@story.id,direction:"up",user_id:current_user,broker_id:current_broker),method: :patch,remote:true do%>
                <div style="font-size:1.5em; border:1px solid; padding-left:3px">
                  <span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span>
                </div>
                <%end%>
              </td>
            </tr>
            <tr>
              <td align="center">
                <span style="font-weight:bold;font-size:1.5em;"><%=@story.votes%></span> 
              </td>
            </tr>
            <tr>
              <td align="center">
                <%=link_to financial_story_path(id:@story.id,direction:"down",user_id:current_user,broker_id:current_broker),method: :patch,remote:true do%>
                <div style="font-size:1.5em; border:1px solid; padding-left:3px">
                  <span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>
                </div>
                <%end%>
              </td>
            </tr>
          </table>
        </td>
        <td width="80%" class="financial_story"><%=@story.description%></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td>Posted at <%=@story.created_at.strftime("%b,%y at %l:%M %P")%></td>
      </tr>
    </table>
  </div>
</div>

<%=render "financial_stories/error"%>
<div class="panel panel-default">
  <div class="panel-body" align="left">
    <%@comments=@story.micro_comments%>
    <h3><%=pluralize( @comments.size, 'comment' )%></h3>
    <%@comments.each do |comment|%>
    <div class="panel panel-default">
      <div class="panel-body">
        <table width="100%">
          <tr>
            <%author=comment.user || comment.broker%>
            <td width="15%">        
              <%=smart_image(author,4)%><br>
              <%=full_name(author)%>
            </td>
            <td width="85%" class="financial_story_comment">
              <%=comment.description%>
            </td>
          </tr>
          <tr>
            <td></td>
            <td>Posted at <%=comment.created_at.strftime("%b,%y at %l:%M %P")%>
            <%if (comment.user==current_user) || (comment.broker==current_broker)%>
              <div style="float:right">
                <table>
                  <tr>
                    <td><%=button_to "Edit"%></td>
                    <td><%=button_to "Delete", {controller:"micro_comments",action:"destroy", id:comment.id},method: :delete, class:"btn btn-default", remote:true%></td>
                  </tr>
                </table>

              </div>
            <%end%>
            
            </td>
          </tr>
        </table>
      </div>
    </div>
    <%end%>    
  </div>
</div>
<div class="panel panel-default">
  <div class="panel-body" align="left">
    <h3>Your comment</h3>
    <table width="100%">
      <tr>
        <td width="15%" style="vertical-align:text-top;">        
          <%=smart_image(current_user,4)%>
        </td>
        <td width="85%">
          <%=form_for @comment, remote:true do |f|%>
            <%=f.text_area :description, {rows:"5",class:"form-control"}%>
            <%=f.submit "Leave Comment", class:"btn btn-default"%>
            <%=f.hidden_field :financial_story_id, value:@story.id%>
            <%if user_logged_in?%>
            <%=f.hidden_field :user_id, value:current_user.id%>
            <%elsif broker_logged_in?%>
            <%=f.hidden_field :broker_id, value:current_broker.id%>
            <%end%>

          <%end%>
        </td>

      </tr>
    </table>
  </div>
</div>